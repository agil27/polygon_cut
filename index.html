<body>
    <div width=100% height="200">
        <button type="button" onclick="draw_major()">绘制主多边形</button>
        <button type="button" onclick="draw_cut()">绘制裁剪多边形</button>
        <button type="button" onclick="cut()">裁剪</button>
    </div>
    
    <canvas id="quad" width="1500" height="1000" style="background: antiquewhite" oncontextmenu="return false"></canvas>
    
    <script>
        function polygon(poly, context, color) {
            context.beginPath();
            context.moveTo(poly[0], poly[1]);
            context.strokeStyle = color
            for (var i = 2; i < 8; i += 2) {
                context.lineTo(poly[i], poly[i + 1]);
                console.log(poly[i], poly[i + 1]);
            }
            context.closePath();
            context.fill();
            context.stroke();
        }
        
        status = 0 // 0, 1, 2, 3, 4 分别代表没有交互，画主多边形且没有未闭合的环，画主多边形且有未闭合的环，画裁剪多边形且没有未闭合的环，画裁剪多边形且有未闭合的环

        function draw_major() {
            status = 1
        }

        function draw_cut() {
            status = 3
        }

        function find_intersections() {

        }
        
        function cut() {

        }

        major_points = []
        cut_points = []

        // 获得 canvas.context
        var canvas = document.getElementById("quad")
        var context = canvas.getContext("2d")

        context.fillStyle = "white"
        context.lineWidth = 2

        canvas.onmousedown = function(e) {
            x = e.clientX-canvas.offsetLeft
            y = e.clientY-canvas.offsetTop

            // 画主多边形
            if (Number(status) === 1) {
                if (e.button == 0) {
                    major_points.push([])
                    last_ring = major_points[major_points.length - 1]
                    context.beginPath()
                    context.fillStyle = "blue"
                    context.strokeStyle = "blue"
                    context.arc(x, y, 5, 0, 2 * Math.PI, true)
                    context.fill()
                    context.stroke()
                    context.moveTo(x, y)
                    x = e.clientX-canvas.offsetLeft
                    y = e.clientY-canvas.offsetTop
                    last_ring.push([x, y])
                    status = 2
                }
            }
            if (Number(status) === 2) {
                last_ring = major_points[major_points.length - 1]
                
                if (e.button == 0) {
                    last_ring.push([x, y])
                    context.fillStyle = "blue"
                    context.strokeStyle = "blue"
                    context.lineTo(x, y)
                    context.stroke()
                    context.beginPath()
                    context.arc(x, y, 5, 0, 2 * Math.PI, true)
                    context.fill()
                    context.stroke()
                    context.moveTo(x, y)
                }
                if (e.button == 2) {
                    last_ring.push(last_ring[0])
                    context.fillStyle = "blue"
                    context.strokeStyle = "blue"
                    context.lineTo(last_ring[0][0], last_ring[0][1])
                    context.stroke()
                    context.beginPath()
                    status = 1
                    context.beginPath()
                    context.line
                }
            }
            
            // 画裁剪多边形
            if (Number(status) === 3) {
                context.fillStyle = "red"
                context.strokeStyle = "red"
                if (e.button == 0) {
                    cut_points.push([])
                    last_ring = cut_points[cut_points.length - 1]
                    context.beginPath()
                    context.arc(x, y, 5, 0, 2 * Math.PI, true)
                    context.fill()
                    context.stroke()
                    context.moveTo(x, y)
                    x = e.clientX-canvas.offsetLeft
                    y = e.clientY-canvas.offsetTop
                    last_ring.push([x, y])
                    status = 4
                }
            }
            if (Number(status) === 4) {
                context.fillStyle = "red"
                context.strokeStyle = "red"
                last_ring = cut_points[cut_points.length - 1]
                
                if (e.button == 0) {
                    last_ring.push([x, y])
                    context.lineTo(x, y)
                    context.stroke()
                    context.beginPath()
                    context.arc(x, y, 5, 0, 2 * Math.PI, true)
                    context.fill()
                    context.stroke()
                    context.moveTo(x, y)
                }
                if (e.button == 2) {
                    last_ring.push(last_ring[0])
                    context.lineTo(last_ring[0][0], last_ring[0][1])
                    context.stroke()
                    context.beginPath()
                    status = 3
                    context.beginPath()
                    context.line
                }
            }
        }
    </script>
    
    </body>